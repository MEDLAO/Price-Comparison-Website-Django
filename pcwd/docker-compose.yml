services:
  # Django app with Gunicorn (web server)
  web:
    image: "${DOCKER_HUB_REGISTRY_IMAGE:-medlao/pcwd-fromsifr:latest}"
    volumes:
      - static_volume:/app/staticfiles  # Static files volume (shared between Django and Nginx)
      - media_volume:/app/media  # Media files volume (shared between Django and Nginx)
    expose:
      - "8000"  # Expose port 8000 for Gunicorn
    restart: always  # Automatically restart the container if it fails

  # Nginx web server to reverse proxy requests to Gunicorn
  nginx:
    image: nginx:latest  # Use the latest official Nginx image
    ports:
      - "80:80"  # Map port 80 for HTTP
      - "443:443"  # Map port 443 for HTTPS
    volumes:
      - static_volume:/app/staticfiles  # Serve static files
      - media_volume:/app/media  # Serve media files
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf  # Custom Nginx config file
    depends_on:
      - web  # Ensure Nginx starts after Gunicorn
    restart: always  # Automatically restart the container if it fails

# Define Docker volumes for static and media files
volumes:
  static_volume:  # Persistent storage for static files
  media_volume:  # Persistent storage for media files
